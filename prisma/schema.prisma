generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  STUDENT
  PROFESSOR
  ADMINISTRATOR
}

enum Department {
  ART_HISTORY
  BIOLOGY
  CHEMISTRY
  CLASSICAL_STUDIES
  COMMUNICATION
  COMPUTER_SCIENCE
  ECONOMICS
  EDUCATION
  ENGINEERING_SCIENCE
  ENGLISH
  GEOSCIENCES
  HEALTH_CARE_ADMINISTRATION
  HISTORY
  MATHMATICS
  MUSIC
  PHILLOSOPHY
  // ...and more if we want to include a complete list.
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum Term {
  SPRING_2021
  FALL_2021
  SPRING_2022
  FALL_2022
  SPRING_2023
}

model User {
  id             String          @id @default(auto()) @map("_id") @db.ObjectId
  isMock         Boolean
  role           Role
  email          String          @unique
  firstName      String
  lastName       String
  registrations  Registration[]
  instructing    CourseSection[] @relation(name: "instructors", fields: [instructingIds], references: [id])
  instructingIds String[]        @db.ObjectId
  coursesCreated Course[]        @relation(name: "createdBy")
  coursesUpdated Course[]        @relation(name: "updatedBy", fields: [updatedIds], references: [id])
  updatedIds     String[]        @db.ObjectId
}

model Registration {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  user            User          @relation(fields: [userId], references: [id])
  userId          String        @db.ObjectId
  courseSection   CourseSection @relation(fields: [courseSectionId], references: [id])
  courseSectionId String        @db.ObjectId

  @@unique([userId, courseSectionId])
}

model Course {
  id             String          @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  term           Term
  department     Department
  code           Int
  description    String
  courseSections CourseSection[]
  
  createdBy      User            @relation(name: "createdBy", fields: [createdById], references: [id])
  createdById    String          @db.ObjectId
  createdOn      String
  updatedByUsers User[]          @relation(name: "updatedBy", fields: [updatedByIds], references: [id])
  updatedByIds   String[]        @db.ObjectId
  updatedOnTimes String[]
  
}

type Meeting {
  daysOfWeek DayOfWeek[]
  startTime  String
  endTime    String
  location   String
}

model CourseSection {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  course        Course         @relation(fields: [courseId], references: [id])
  courseId      String         @db.ObjectId
  meetings      Meeting[]
  instructors   User[]         @relation(name: "instructors", fields: [instructorIds], references: [id])
  instructorIds String[]       @db.ObjectId
  registrations Registration[]
}
